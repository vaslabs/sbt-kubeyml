<html><head><title>sbt-kubeyml: Service manifest</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Vasilis Nicolaou" /><meta name="description" content="Autogenerate kubernetes manifests for your scala application" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="sbt-kubeyml: Service manifest" /><meta name="title" property="og:title" content="sbt-kubeyml: Service manifest" /><meta name="og:site_name" content="sbt-kubeyml" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Autogenerate kubernetes manifests for your scala application" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="sbt-kubeyml: Service manifest" /><meta name="twitter:image" content="http://sbt-kubeyml.vaslabs.org/img/poster.png" /><meta name="twitter:description" content="Autogenerate kubernetes manifests for your scala application" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@vaslabs" /><meta name="twitter:creator" content="@vaslabs" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/light-style.css" /><link rel="stylesheet" href="/css/home.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>sbt-kubeyml</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/deployment/" title="Deployment" class="drop-nested">Deployment</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/deployment/recipe/" title="Recipes" class="">Recipes</a></div></div> <div class="sidebar-nav-item active open"><a href="/service/" title="Service" class="drop-nested">Service</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/service/recipe/" title="Recipes" class="">Recipes</a></div></div> <div class="sidebar-nav-item  "><a href="/ingress/" title="Ingress" class="drop-nested">Ingress</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/ingress/recipe/" title="Recipes" class="">Recipes</a></div></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vaslabs/sbt-kubeyml" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vaslabs/sbt-kubeyml" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="vaslabs" data-github-repo="sbt-kubeyml"><div class="content-wrapper"><section><h1 id="service">Service</h1>

<p>This generates a service manifest as described here https://kubernetes.io/docs/concepts/services-networking/service/#defining-a-service</p>

<p>Generating a service is very simple and normally you just need to enable the service plugin. 
 The service plugin depends on the deployment plugin and thus, every property of
the service is automatically derived from the deployment definition.</p>

<p>Consider the nginx deployment from previous, we can fully derive the service:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">kubeyml.deployment._</span>
<span class="k">import</span> <span class="nn">kubeyml.service._</span>
<span class="k">import</span> <span class="nn">kubeyml.deployment.api._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">val</span> <span class="nv">deployment</span> <span class="k">=</span> <span class="nv">deploy</span><span class="o">.</span><span class="py">namespace</span><span class="o">(</span><span class="s">"yournamespace"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">service</span><span class="o">(</span><span class="s">"nginx-deployment"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withImage</span><span class="o">(</span><span class="s">"nginx:1.7.9"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withProbes</span><span class="o">(</span>
      <span class="n">livenessProbe</span> <span class="k">=</span> <span class="nc">HttpProbe</span><span class="o">(</span><span class="nc">HttpGet</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">port</span> <span class="k">=</span> <span class="mi">80</span><span class="o">,</span> <span class="n">httpHeaders</span> <span class="k">=</span> <span class="nv">List</span><span class="o">.</span><span class="py">empty</span><span class="o">),</span> <span class="n">period</span> <span class="k">=</span> <span class="mi">10</span> <span class="n">seconds</span><span class="o">),</span>
      <span class="n">readinessProbe</span> <span class="k">=</span> <span class="nc">HttpProbe</span><span class="o">(</span><span class="nc">HttpGet</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">port</span> <span class="k">=</span> <span class="mi">80</span><span class="o">,</span> <span class="n">httpHeaders</span> <span class="k">=</span> <span class="nv">List</span><span class="o">.</span><span class="py">empty</span><span class="o">),</span> <span class="n">failureThreshold</span> <span class="k">=</span> <span class="mi">10</span><span class="o">)</span>
    <span class="o">).</span><span class="py">replicas</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
    <span class="o">.</span><span class="py">pullDockerImage</span><span class="o">(</span><span class="nc">IfNotPresent</span><span class="o">)</span>
    <span class="o">.</span><span class="py">addPorts</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">Port</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="mi">80</span><span class="o">))</span>
  <span class="o">)</span>

  <span class="k">val</span> <span class="nv">service</span> <span class="k">=</span> <span class="nv">Service</span><span class="o">.</span><span class="py">fromDeployment</span><span class="o">(</span><span class="n">deployment</span><span class="o">)</span>
 
</code></pre></div></div>

<p>Which would generate the following service.yml file</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-deployment</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">yournamespace</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">selector</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">nginx-deployment</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span>   <span class="na">name</span><span class="pi">:</span> <span class="s">pn80</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
        <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
        <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span>
</code></pre></div></div>

<p>At the moment there’s little room for customisation. If you have a use-case you can open an issue or even better a
pull request.</p>

<h2 id="sbt-properties">Sbt Properties</h2>

<p>These are the available properties that you can customise from the sbt layer.</p>

<table>
  <thead>
    <tr>
      <th><strong>sbt key</strong></th>
      <th><strong>description</strong></th>
      <th><strong>default</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>portMappings</td>
      <td>Port mappings against the deployment (service to pod)</td>
      <td>Derived from deployment</td>
    </tr>
    <tr>
      <td>service</td>
      <td>Key configuration for modifying the service properties</td>
      <td>Derived from deployment</td>
    </tr>
  </tbody>
</table>

<p>You can also create your own instance
of the service case class and see how far customisation can get you.</p>

<p>There’s no DSL for this yet.</p>

<p>Go to the <a href="recipe/">service recipe</a> for a full deployment example.</p>

</section></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
              </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/docs.js"></script></body></html>