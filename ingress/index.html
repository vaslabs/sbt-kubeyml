<!DOCTYPE html><html><head><title>sbt-kubeyml: Ingress manifest</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Vasilis Nicolaou" /><meta name="description" content="Autogenerate kubernetes manifests for your scala application" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="sbt-kubeyml: Ingress manifest" /><meta name="title" property="og:title" content="sbt-kubeyml: Ingress manifest" /><meta name="og:site_name" content="sbt-kubeyml" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Autogenerate kubernetes manifests for your scala application" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="sbt-kubeyml: Ingress manifest" /><meta name="twitter:image" content="https://sbt-kubeyml.vaslabs.org/img/poster.png" /><meta name="twitter:description" content="Autogenerate kubernetes manifests for your scala application" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@vaslabs" /><meta name="twitter:creator" content="@vaslabs" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/light-style.css" /><link rel="stylesheet" href="/css/home.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>sbt-kubeyml</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/deployment/" title="Deployment" class="drop-nested">Deployment</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/deployment/recipe/" title="Recipes" class="">Recipes</a></div></div> <div class="sidebar-nav-item  "><a href="/service/" title="Service" class="drop-nested">Service</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/service/recipe/" title="Recipes" class="">Recipes</a></div></div> <div class="sidebar-nav-item active open"><a href="/ingress/" title="Ingress" class="drop-nested">Ingress</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/ingress/recipe/" title="Recipes" class="">Recipes</a></div></div> <div class="sidebar-nav-item  "><a href="/helm/" title="Helm" class="">Helm</a></div> <div class="sidebar-nav-item  "><a href="/akka-cluster/" title="Akka cluster" class="drop-nested">Akka cluster</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/akka-cluster/settings/" title="Settings" class="">Settings</a> <a href="/akka-cluster/recipe/" title="Recipes" class="">Recipes</a></div></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/vaslabs/sbt-kubeyml" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/vaslabs/sbt-kubeyml" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="vaslabs" data-github-repo="sbt-kubeyml"><div class="content-wrapper"><section><h1 id="ingress">Ingress</h1>

<p>This generates an ingress as defined <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource">here</a></p>

<p>The ingress derives some properties from the service but it requires you to set the hostname.</p>

<p>If we continue with our nginx example from the <a href="service">service</a> section, the ingress looks like this</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">import</span> <span class="nn">kubeyml.protocol.Host</span>
<span class="k">import</span> <span class="nn">kubeyml.ingress.</span><span class="o">{</span><span class="nc">CustomIngress</span><span class="o">,</span> <span class="nc">HttpRule</span><span class="o">,</span> <span class="nc">Ingress</span><span class="o">,</span> <span class="nc">ServiceMapping</span><span class="o">,</span> <span class="nc">Path</span> <span class="k">=&gt;</span> <span class="nc">IngressPath</span><span class="o">,</span> <span class="nc">Spec</span> <span class="k">=&gt;</span> <span class="nc">IngressSpec</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">kubeyml.ingress.api.Annotate</span>

<span class="k">import</span> <span class="nn">kubeyml.deployment.</span><span class="o">{</span><span class="nc">HttpProbe</span><span class="o">,</span> <span class="nc">IfNotPresent</span><span class="o">,</span> <span class="nc">HttpGet</span><span class="o">,</span> <span class="nc">Port</span> <span class="k">=&gt;</span> <span class="nc">DeployPort</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">kubeyml.service._</span>
<span class="k">import</span> <span class="nn">kubeyml.deployment.api._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">val</span> <span class="nv">deployment</span> <span class="k">=</span> <span class="nv">deploy</span><span class="o">.</span><span class="py">namespace</span><span class="o">(</span><span class="s">"yournamespace"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">service</span><span class="o">(</span><span class="s">"nginx-deployment"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withImage</span><span class="o">(</span><span class="s">"nginx:1.7.9"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withProbes</span><span class="o">(</span>
      <span class="n">livenessProbe</span> <span class="k">=</span> <span class="nc">HttpProbe</span><span class="o">(</span><span class="nc">HttpGet</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">port</span> <span class="k">=</span> <span class="mi">80</span><span class="o">,</span> <span class="n">httpHeaders</span> <span class="k">=</span> <span class="nv">List</span><span class="o">.</span><span class="py">empty</span><span class="o">),</span> <span class="n">period</span> <span class="k">=</span> <span class="mi">10</span> <span class="n">seconds</span><span class="o">),</span>
      <span class="n">readinessProbe</span> <span class="k">=</span> <span class="nc">HttpProbe</span><span class="o">(</span><span class="nc">HttpGet</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">port</span> <span class="k">=</span> <span class="mi">80</span><span class="o">,</span> <span class="n">httpHeaders</span> <span class="k">=</span> <span class="nv">List</span><span class="o">.</span><span class="py">empty</span><span class="o">),</span> <span class="n">failureThreshold</span> <span class="k">=</span> <span class="mi">10</span><span class="o">)</span>
    <span class="o">).</span><span class="py">replicas</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
    <span class="o">.</span><span class="py">pullDockerImage</span><span class="o">(</span><span class="nc">IfNotPresent</span><span class="o">)</span>
    <span class="o">.</span><span class="py">addPorts</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">DeployPort</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="mi">80</span><span class="o">))</span>
  <span class="o">)</span>

  <span class="k">val</span> <span class="nv">service</span> <span class="k">=</span> <span class="nv">Service</span><span class="o">.</span><span class="py">fromDeployment</span><span class="o">(</span><span class="n">deployment</span><span class="o">)</span>
 
<span class="k">val</span> <span class="nv">ingress</span><span class="k">:</span> <span class="kt">Ingress</span> <span class="o">=</span> <span class="nc">CustomIngress</span><span class="o">(</span>
    <span class="s">"nginx-ingress"</span><span class="o">,</span>
    <span class="s">"yournamespace"</span><span class="o">,</span>
    <span class="nc">Map</span><span class="o">(</span><span class="nv">Annotate</span><span class="o">.</span><span class="py">nginxRewriteTarget</span><span class="o">(</span><span class="s">"/"</span><span class="o">),</span> <span class="nv">Annotate</span><span class="o">.</span><span class="py">nginxIngress</span><span class="o">()),</span>
    <span class="nc">IngressSpec</span><span class="o">(</span>
      <span class="nc">List</span><span class="o">(</span><span class="nc">HttpRule</span><span class="o">(</span><span class="nc">Host</span><span class="o">(</span><span class="s">"your-host.domain.smth"</span><span class="o">),</span>
      <span class="nc">List</span><span class="o">(</span><span class="nc">IngressPath</span><span class="o">(</span><span class="nc">ServiceMapping</span><span class="o">(</span><span class="s">"nginx-deployment"</span><span class="o">,</span> <span class="mi">80</span><span class="o">),</span> <span class="s">"/testpath"</span><span class="o">))))</span>
    <span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>

<p>Since version 0.2.9, ingress uses the new API version following this migration <a href="https://kubernetes.io/blog/2019/07/18/api-deprecations-in-1-16/">guide</a></p>

<p>This would generate the following yaml file</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">annotations</span><span class="pi">:</span>
        <span class="na">nginx.ingress.kubernetes.io/rewrite-target</span><span class="pi">:</span> <span class="s">/</span>
        <span class="na">kubernetes.io/ingress.class</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-ingress</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">yournamespace</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span>   <span class="na">host</span><span class="pi">:</span> <span class="s">your-host.domain.smth</span>
        <span class="na">http</span><span class="pi">:</span>
            <span class="na">paths</span><span class="pi">:</span>
            <span class="pi">-</span>   <span class="na">backend</span><span class="pi">:</span>
                    <span class="na">serviceName</span><span class="pi">:</span> <span class="s">nginx-deployment</span>
                    <span class="na">servicePort</span><span class="pi">:</span> <span class="m">80</span>
                <span class="na">path</span><span class="pi">:</span> <span class="s">/testpath</span>
</code></pre></div></div>

<p>To switch to the legacy apiVersion simply do:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">toExtensions_v1beta1</span><span class="o">(</span><span class="n">customIngress</span><span class="k">:</span> <span class="kt">CustomIngress</span><span class="o">)</span> <span class="k">=</span>
    <span class="nv">customIngress</span><span class="o">.</span><span class="py">legacy</span>
</code></pre></div></div>

<p>Of course in most cases you won’t have to write any of this as the sbt properties that sit on top of the API are
derived from the service plugin which this depends upon. See the <a href="recipe/">recipe</a> for an example.</p>

<h2 id="sbt-properties">Sbt properties</h2>

<table>
  <thead>
    <tr>
      <th><strong>sbt key</strong></th>
      <th><strong>description</strong></th>
      <th><strong>default</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ingressRules</td>
      <td>A list of Rules (currently only supports HttpRule</td>
      <td>N/A</td>
    </tr>
    <tr>
      <td>ingressName</td>
      <td>The name of the ingress</td>
      <td>The application name from deployment</td>
    </tr>
    <tr>
      <td>ingress</td>
      <td>Key configuration for modifying the ingress properties</td>
      <td>Some values are derived from service</td>
    </tr>
  </tbody>
</table>

</section></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script src="/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/search.js"></script><script src="/js/docs.js"></script></body></html>